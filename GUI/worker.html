<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Worker Dashboard - SRM Connect</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; display: flex; min-height: 100vh; background-color: #f5f5f5; }

    .sidebar { width: 230px; background-color: #0d5cb6; color: white; padding: 20px 0; position: fixed; height: 100vh; left: 0; top: 0; }
    .logo-section { display: flex; align-items: center; gap: 12px; padding: 0 20px 30px; border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 30px; }
    .logo { width: 50px; height: 50px; background-color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #0d5cb6; }
    .logo-text { font-size: 18px; font-weight: 600; }
    .nav-menu { list-style: none; }
    .nav-item { padding: 15px 20px; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; gap: 12px; }
    .nav-item:hover { background-color: rgba(255, 255, 255, 0.1); }
    .nav-item.active { background-color: rgba(255, 255, 255, 0.2); }

    .main-content { margin-left: 230px; flex: 1; padding: 30px 40px; }
    .header { margin-bottom: 30px; }
    .header h1 { font-size: 32px; color: #1f2937; margin-bottom: 8px; }
    .welcome-text { color: #6b7280; font-size: 16px; }

    .tasks-section { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .tasks-section h2 { font-size: 24px; color: #1f2937; margin-bottom: 20px; }

    table { width: 100%; border-collapse: collapse; }
    thead { background-color: #f9fafb; }
    th { text-align: left; padding: 15px; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; }
    td { padding: 18px 15px; border-bottom: 1px solid #e5e7eb; color: #1f2937; }
    tbody tr:hover { background-color: #f9fafb; cursor: pointer; }

    .badge { display: inline-block; padding: 6px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; }
    .badge.orange { background-color: #fb923c; color: white; }
    .badge.green { background-color: #22c55e; color: white; }
    .badge.blue { background-color: #3b82f6; color: white; }

    .status-select { padding: 6px 10px; border-radius: 4px; border: 1px solid #d1d5db; font-size: 14px; cursor: pointer; }

    @media (max-width: 768px) {
        .sidebar { width: 70px; }
        .logo-text, .nav-item span { display: none; }
        .main-content { margin-left: 70px; padding: 20px; }
        table { font-size: 14px; }
        th, td { padding: 10px 8px; }
    }
</style>
</head>
<body>
<aside class="sidebar">
    <div class="logo-section">
        <div class="logo">üõ†Ô∏è</div>
        <div class="logo-text">SRM Connect</div>
    </div>
    <ul class="nav-menu">
        <li class="nav-item active">
            <span class="nav-icon">üìä</span>
            <span>Dashboard</span>
        </li>
        <li class="nav-item">
            <span class="nav-icon">üë§</span>
            <span>Profile</span>
        </li>
    </ul>
</aside>

<main class="main-content">
    <div class="header">
        <h1>Worker Dashboard</h1>
        <p class="welcome-text">Welcome back, worker1</p>
    </div>

    <div class="tasks-section">
        <h2>My Assigned Tasks</h2>
        <table id="tasksTable">
            <thead>
                <tr>
                    <th>Task ID</th>
                    <th>Location</th>
                    <th>Status</th>
                    <th>Update Status</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be populated via fetch -->
            </tbody>
        </table>
    </div>
</main>

<script>
const navItems = document.querySelectorAll('.nav-item');
navItems.forEach(item => {
    item.addEventListener('click', function() {
        navItems.forEach(nav => nav.classList.remove('active'));
        this.classList.add('active');
    });
});

// Fetch worker's assigned tasks
function fetchTasks() {
    fetch('../servlets/WorkerDashboardServlet')
        .then(res => res.json())
        .then(data => {
            const tbody = document.querySelector('#tasksTable tbody');
            tbody.innerHTML = '';
            data.forEach(task => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${task.complaint_id}</td>
                    <td>${task.floor} - ${task.room}</td>
                    <td><span class="badge ${getBadgeClass(task.status)}">${task.status}</span></td>
                    <td>
                        <select class="status-select" onchange="updateStatus(${task.complaint_id}, this.value)">
                            <option value="Pending" ${task.status==='Pending'?'selected':''}>Pending</option>
                            <option value="In Progress" ${task.status==='In Progress'?'selected':''}>In Progress</option>
                            <option value="Completed" ${task.status==='Completed'?'selected':''}>Completed</option>
                        </select>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        });
}

function getBadgeClass(status) {
    if(status==='Pending') return 'orange';
    if(status==='In Progress') return 'blue';
    if(status==='Completed') return 'green';
    return '';
}

// Update status
function updateStatus(id, status) {
    fetch('../servlets/UpdateTaskStatusServlet', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: `complaint_id=${id}&status=${status}`
    }).then(res => {
        if(res.ok) fetchTasks();
    });
}

fetchTasks();
</script>
</body>
</html>
