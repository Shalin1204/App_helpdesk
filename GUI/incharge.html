<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Incharge Dashboard - SRM Connect</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; display: flex; min-height: 100vh; background-color: #f5f5f5; }
    .sidebar { width: 230px; background-color: #0d5cb6; color: white; padding: 20px 0; position: fixed; height: 100vh; left: 0; top: 0; }
    .logo-section { display: flex; align-items: center; gap: 12px; padding: 0 20px 30px; border-bottom: 1px solid rgba(255, 255, 255, 0.2); margin-bottom: 30px; }
    .logo { width: 50px; height: 50px; background-color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #0d5cb6; }
    .logo-text { font-size: 18px; font-weight: 600; }
    .nav-menu { list-style: none; }
    .nav-item { padding: 15px 20px; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; gap: 12px; }
    .nav-item:hover { background-color: rgba(255, 255, 255, 0.1); }
    .nav-item.active { background-color: rgba(255, 255, 255, 0.2); }
    .main-content { margin-left: 230px; flex: 1; padding: 30px 40px; }
    .header { margin-bottom: 30px; }
    .header h1 { font-size: 32px; color: #1f2937; margin-bottom: 8px; }
    .welcome-text { color: #6b7280; font-size: 16px; }
    .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
    .stat-card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .stat-title { color: #6b7280; font-size: 14px; margin-bottom: 12px; }
    .stat-number { font-size: 48px; font-weight: 700; color: #1f2937; margin-bottom: 12px; }
    .badge { display: inline-block; padding: 6px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; }
    .badge.orange { background-color: #fb923c; color: white; }
    .badge.green { background-color: #22c55e; color: white; }
    .badge.blue { background-color: #3b82f6; color: white; }
    .tasks-section { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .tasks-section h2 { font-size: 24px; color: #1f2937; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; }
    thead { background-color: #f9fafb; }
    th { text-align: left; padding: 15px; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; }
    td { padding: 18px 15px; border-bottom: 1px solid #e5e7eb; color: #1f2937; }
    tr:last-child td { border-bottom: none; }
    tbody tr:hover { background-color: #f9fafb; cursor: pointer; }
    select.assign-worker { padding: 6px 10px; border-radius: 4px; border: 1px solid #d1d5db; }
    @media (max-width: 768px) {
        .sidebar { width: 70px; }
        .logo-text, .nav-item span { display: none; }
        .main-content { margin-left: 70px; padding: 20px; }
        .stats-container { grid-template-columns: 1fr; }
        table { font-size: 14px; }
        th, td { padding: 10px 8px; }
    }
</style>
</head>
<body>
<aside class="sidebar">
    <div class="logo-section">
        <div class="logo">üè´</div>
        <div class="logo-text">SRM Connect</div>
    </div>
    <ul class="nav-menu">
        <li class="nav-item active"><span class="nav-icon">üìä</span><span>Dashboard</span></li>
        <li class="nav-item"><span class="nav-icon">üìã</span><span>All Tasks</span></li>
        <li class="nav-item"><span class="nav-icon">üë§</span><span>Profile</span></li>
    </ul>
</aside>

<main class="main-content">
    <div class="header">
        <h1>Incharge Dashboard</h1>
        <p class="welcome-text">Welcome back, incharge1</p>
    </div>

    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-title">Total Tasks</div>
            <div class="stat-number" id="totalTasks">0</div>
            <span class="badge orange">Pending</span>
        </div>
        <div class="stat-card">
            <div class="stat-title">Completed</div>
            <div class="stat-number" id="completedTasks">0</div>
            <span class="badge green">Completed</span>
        </div>
    </div>

    <div class="tasks-section">
        <h2>All Assigned Tasks</h2>
        <table>
            <thead>
                <tr>
                    <th>Task ID</th>
                    <th>Assigned To</th>
                    <th>Location</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="tasksTableBody">
                <!-- Rows will be populated dynamically -->
            </tbody>
        </table>
    </div>
</main>

<script>
const navItems = document.querySelectorAll('.nav-item');
navItems.forEach(item => {
    item.addEventListener('click', function() {
        navItems.forEach(nav => nav.classList.remove('active'));
        this.classList.add('active');
    });
});

document.addEventListener("DOMContentLoaded", () => {
    fetch("../servlets/FetchComplaintsServlet")
        .then(response => response.json())
        .then(data => {
            const tbody = document.getElementById("tasksTableBody");
            const totalTasksEl = document.getElementById("totalTasks");
            const completedTasksEl = document.getElementById("completedTasks");

            tbody.innerHTML = "";
            let total = 0, completed = 0;

            data.forEach(task => {
                total++;
                if(task.status.toLowerCase() === "completed") completed++;

                let statusClass = "orange";
                if(task.status.toLowerCase() === "completed") statusClass = "green";
                else if(task.status.toLowerCase() === "in progress") statusClass = "blue";

                tbody.innerHTML += `
                    <tr>
                        <td>${task.complaint_id}</td>
                        <td>
                            <select class="assign-worker" data-task-id="${task.complaint_id}">
                                <option value="">--Assign Worker--</option>
                                ${task.assigned_to ? `<option selected>${task.assigned_to}</option>` : ""}
                                <option value="worker1">worker1</option>
                                <option value="worker2">worker2</option>
                                <option value="worker3">worker3</option>
                            </select>
                        </td>
                        <td>${task.floor} | ${task.room}</td>
                        <td><span class="badge ${statusClass}">${task.status}</span></td>
                    </tr>
                `;
            });

            totalTasksEl.textContent = total;
            completedTasksEl.textContent = completed;
        })
        .catch(err => console.error("Error fetching tasks:", err));
});
</script>
</body>
</html>
